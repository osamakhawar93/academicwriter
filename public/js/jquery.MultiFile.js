;if(window.jQuery)(function($){"use strict";function sl(x){return x>1048576?(x/1048576).toFixed(1)+'Mb':(x==1024?'1Mb':(x/1024).toFixed(1)+'Kb')};function FILE_LIST(x){return((x.files&&x.files.length)?x.files:null)||[{name:x.value,size:0,type:((x.value||'').match(/[^\.]+$/i)||[''])[0]}];};$.fn.MultiFile=function(options){if(this.length==0)return this;if(typeof arguments[0]=='string'){if(this.length>1){var args=arguments;return this.each(function(){$.fn.MultiFile.apply($(this),args);});};return $.fn.MultiFile[arguments[0]].apply(this,$.makeArray(arguments).slice(1)||[]);};if(typeof options=='number'){options={max:options};};var options=$.extend({},$.fn.MultiFile.options,options||{});$('form').not('MultiFile-intercepted').addClass('MultiFile-intercepted').submit($.fn.MultiFile.disableEmpty);if($.fn.MultiFile.options.autoIntercept){$.fn.MultiFile.intercept($.fn.MultiFile.options.autoIntercept);$.fn.MultiFile.options.autoIntercept=null;};this.not('.MultiFile-applied').addClass('MultiFile-applied').each(function(){window.MultiFile=(window.MultiFile||0)+1;var group_count=window.MultiFile;var MultiFile={e:this,E:$(this),clone:$(this).clone()};var o=$.extend({},$.fn.MultiFile.options,options||{},($.metadata?MultiFile.E.metadata():($.meta?MultiFile.E.data():null))||{},{});if(!(o.max>0)){o.max=MultiFile.E.attr('maxlength');};if(!(o.max>0)){o.max=(String(MultiFile.e.className.match(/\b(max|limit)\-([0-9]+)\b/gi)||['']).match(/[0-9]+/gi)||[''])[0];if(!(o.max>0))o.max=-1;else o.max=String(o.max).match(/[0-9]+/gi)[0];};o.max=new Number(o.max);o.accept=o.accept||MultiFile.E.attr('accept')||'';if(!o.accept){o.accept=(MultiFile.e.className.match(/\b(accept\-[\w\|]+)\b/gi))||'';o.accept=new String(o.accept).replace(/^(accept|ext)\-/i,'');};o.maxsize=o.maxsize>0?o.maxsize:null||MultiFile.E.data('maxsize')||0;if(!(o.maxsize>0)){o.maxsize=(String(MultiFile.e.className.match(/\b(maxsize|maxload|size)\-([0-9]+)\b/gi)||['']).match(/[0-9]+/gi)||[''])[0];if(!(o.maxsize>0))o.maxsize=-1;else o.maxsize=String(o.maxsize).match(/[0-9]+/gi)[0];};o.maxfile=o.maxfile>0?o.maxfile:null||MultiFile.E.data('maxfile')||0;if(!(o.maxfile>0)){o.maxfile=(String(MultiFile.e.className.match(/\b(maxfile|filemax)\-([0-9]+)\b/gi)||['']).match(/[0-9]+/gi)||[''])[0];if(!(o.maxfile>0))o.maxfile=-1;else o.maxfile=String(o.maxfile).match(/[0-9]+/gi)[0];};if(o.maxfile>1)o.maxfile=o.maxfile*1024;if(o.maxsize>1)o.maxsize=o.maxsize*1024;if(o.max>1)MultiFile.E.attr('multiple','multiple').prop('multiple',true);$.extend(MultiFile,o||{});MultiFile.STRING=$.extend({},$.fn.MultiFile.options.STRING,MultiFile.STRING);$.extend(MultiFile,{n:0,slaves:[],files:[],instanceKey:MultiFile.e.id||'MultiFile'+String(group_count),generateID:function(z){return MultiFile.instanceKey+(z>0?'_F'+String(z):'');},trigger:function(event,element,MultiFile,files){var rv,handler=MultiFile[event]||MultiFile['on'+event];if(handler){files=files||MultiFile.files||FILE_LIST(this);;$.each(files,function(i,file){rv=handler.apply(MultiFile.wrapper,[element,file.name,MultiFile,file]);});return rv;};}});if(String(MultiFile.accept).length>1){MultiFile.accept=MultiFile.accept.replace(/\W+/g,'|').replace(/^\W|\W$/g,'');MultiFile.rxAccept=new RegExp('\\.('+(MultiFile.accept?MultiFile.accept:'')+')$','gi');};MultiFile.wrapID=MultiFile.instanceKey;MultiFile.E.wrap('<div class="MultiFile-wrap" id="'+MultiFile.wrapID+'"></div>');MultiFile.wrapper=$('#'+MultiFile.wrapID+'');MultiFile.e.name=MultiFile.e.name||'file'+group_count+'[]';if(!MultiFile.list){MultiFile.wrapper.append('<div class="MultiFile-list" id="'+MultiFile.wrapID+'_list"></div>');MultiFile.list=$('#'+MultiFile.wrapID+'_list');};MultiFile.list=$(MultiFile.list);MultiFile.addSlave=function(slave,slave_count){MultiFile.n++;slave.MultiFile=MultiFile;slave.id=slave.name='';slave.id=MultiFile.generateID(slave_count);slave.name=String(MultiFile.namePattern.replace(/\$name/gi,$(MultiFile.clone).attr('name')).replace(/\$id/gi,$(MultiFile.clone).attr('id')).replace(/\$g/gi,group_count).replace(/\$i/gi,slave_count));var disable_slave;if((MultiFile.max>0)&&((MultiFile.files.length)>(MultiFile.max))){slave.disabled=true;disable_slave=true;};MultiFile.current=slave;slave=$(slave);slave.val('').attr('value','')[0].value='';slave.addClass('MultiFile-applied');slave.change(function(a,b,c){$(this).blur();var e=this,prevs=MultiFile.files||[],files=this.files||[{name:this.value,size:0,type:((this.value||'').match(/[^\.]+$/i)||[''])[0]}],newfs=[],newfs_size=0,total_size=MultiFile.total_size||0;var ERROR=[];$.each(files,function(i,file){newfs[newfs.length]=file;});MultiFile.trigger('FileSelect',this,MultiFile,newfs);$.each(files,function(i,file){var v=file.name,s=file.size,p=function(z){return z.replace('$ext',String(v.match(/[^\.]+$/i)||'')).replace('$file',v.match(/[^\/\\]+$/gi)).replace('$size',sl(s)+' > '+sl(MultiFile.maxfile))};if(MultiFile.accept&&v&&!v.match(MultiFile.rxAccept)){ERROR[ERROR.length]=p(MultiFile.STRING.denied);MultiFile.trigger('FileInvalid',this,MultiFile,[file]);};$(MultiFile.wrapper).find('input[type=file]').not(e).each(function(){$.each(FILE_LIST(this),function(i,file){if(file.name){var x=(file.name||'').replace(/^C:\\fakepath\\/gi,'');if(v==x||v==x.substr(x.length-v.length)){ERROR[ERROR.length]=p(MultiFile.STRING.duplicate);MultiFile.trigger('FileDuplicate',e,MultiFile,[file]);};};});});if(MultiFile.maxfile>0&&s>0&&s>MultiFile.maxfile){ERROR[ERROR.length]=p(MultiFile.STRING.toobig);MultiFile.trigger('FileTooBig',this,MultiFile,[file]);};var customError=MultiFile.trigger('FileValidate',this,MultiFile,[file]);if(customError&&customError!=''){ERROR[ERROR.length]=p(customError);};newfs_size+=file.size;});total_size+=newfs_size;newfs.size=newfs_size;newfs.total=total_size;newfs.total_length=newfs.length+prevs.length;if(MultiFile.max>0&&prevs.length+files.length>MultiFile.max){ERROR[ERROR.length]=MultiFile.STRING.toomany.replace('$max',MultiFile.max);MultiFile.trigger('FileTooMany',this,MultiFile,newfs);};if(MultiFile.maxsize>0&&total_size>MultiFile.maxsize){ERROR[ERROR.length]=MultiFile.STRING.toomuch.replace('$size',sl(total_size)+' > '+sl(MultiFile.maxsize));MultiFile.trigger('FileTooMuch',this,MultiFile,newfs);};var newEle=$(MultiFile.clone).clone();newEle.addClass('MultiFile');if(ERROR.length>0){MultiFile.error(ERROR.join('\n\n'));MultiFile.n--;MultiFile.addSlave(newEle[0],slave_count);slave.parent().prepend(newEle);slave.remove();return false;}
else{MultiFile.total_size=total_size;files=prevs.concat(newfs);files.size=total_size;files.size_label=sl(total_size);MultiFile.files=files;$(this).css({position:'absolute',top:'-3000px'});slave.after(newEle);MultiFile.addSlave(newEle[0],slave_count+1);MultiFile.addToList(this,slave_count,newfs);MultiFile.trigger('afterFileSelect',this,MultiFile,newfs);};});$(slave).data('MultiFile-wrap',MultiFile.wrapper);$(MultiFile.wrapper).data('MultiFile',MultiFile);if(disable_slave)$(slave).attr('disabled','disabled').prop('disabled',true);};MultiFile.addToList=function(slave,slave_count,files){MultiFile.trigger('FileAppend',slave,MultiFile,files);var names=$('<span/>');$.each(files,function(i,file){var v=String(file.name||''),S=MultiFile.STRING,n=S.label||S.file||S.name,t=S.title||S.tooltip||S.selected,p='<img class="MultiFile-preview" style="'+MultiFile.previewCss+'"/>',label=$(('<div class="MultiFile-label" title="'+t+'">'+'<span class="MultiFile-title">'+n+'</span>'+(MultiFile.preview||$(slave).is('.with-preview')?p:'')+'</div>').replace(/\$(file|name)/gi,(v.match(/[^\/\\]+$/gi)||[v])[0]).replace(/\$(ext|extension|type)/gi,(v.match(/[^\.]+$/gi)||[''])[0]).replace(/\$(size)/gi,sl(file.size||0)).replace(/\$(preview)/gi,p).replace(/\$(i)/gi,i));label.find('img.MultiFile-preview').each(function(){var t=this;var oFReader=new FileReader();oFReader.readAsDataURL(file);oFReader.onload=function(oFREvent){t.src=oFREvent.target.result;};});names.append(label);var v=String(file.name||'');names[names.length]=('<span class="MultiFile-title" title="'+MultiFile.STRING.selected+'">'+MultiFile.STRING.file+'</span>').replace(/\$(file|name)/gi,(v.match(/[^\/\\]+$/gi)||[v])[0]).replace(/\$(ext|extension|type)/gi,(v.match(/[^\.]+$/gi)||[''])[0]).replace(/\$(size)/gi,sl(file.size||0)).replace(/\$(i)/gi,i);});var
r=$('<div class="MultiFile-label"></div>'),b=$('<a class="MultiFile-remove" href="#'+MultiFile.wrapID+'">'+MultiFile.STRING.remove+'</a>').click(function(){var files_being_removed=FILE_LIST(slave);MultiFile.trigger('FileRemove',slave,MultiFile,files_being_removed);MultiFile.n--;MultiFile.current.disabled=false;$(slave).remove();$(this).parent().remove();$(MultiFile.current).css({position:'',top:''});$(MultiFile.current).reset().val('').attr('value','')[0].value='';var files_remaining=[],remain_size=0;$(MultiFile.wrapper).find('input[type=file]').each(function(){$.each(FILE_LIST(this),function(i,file){if(file.name){files_remaining[files_remaining.length]=file;remain_size+=file.size;};});});MultiFile.files=files_remaining;MultiFile.total_size=remain_size;MultiFile.size_label=sl(remain_size);$(MultiFile.wrapper).data('MultiFile',MultiFile);MultiFile.trigger('afterFileRemove',slave,MultiFile,files_being_removed);MultiFile.trigger('FileChange',MultiFile.current,MultiFile,files_remaining);return false;});MultiFile.list.append(r.append(b,' ',names));MultiFile.trigger('afterFileAppend',slave,MultiFile,files);MultiFile.trigger('FileChange',slave,MultiFile,MultiFile.files);};if(!MultiFile.MultiFile)MultiFile.addSlave(MultiFile.e,0);MultiFile.n++;});};$.extend($.fn.MultiFile,{data:function(){var e=$(this),b=e.is('.MultiFile-wrap');var wp=b?e:e.data('MultiFile-wrap');if(!wp||!wp.length)
return!console.error('Could not find MultiFile control wrapper');var mf=wp.data('MultiFile');if(!mf)
return!console.error('Could not find MultiFile data in wrapper');return mf||{};},reset:function(){var mf=this.MultiFile('data');if(mf)$(mf.list).find('a.MultiFile-remove').click();return $(this);},files:function(){var mf=this.MultiFile('data');if(!mf)return!console.log('MultiFile plugin not initialized');return mf.files||[];},size:function(){var mf=this.MultiFile('data');if(!mf)return!console.log('MultiFile plugin not initialized');return mf.total_size||0;},count:function(){var mf=this.MultiFile('data');if(!mf)return!console.log('MultiFile plugin not initialized');return mf.files?mf.files.length||0:0;},disableEmpty:function(klass){klass=(typeof(klass)=='string'?klass:'')||'mfD';var o=[];$('input:file.MultiFile').each(function(){if($(this).val()=='')o[o.length]=this;});window.clearTimeout($.fn.MultiFile.reEnableTimeout);$.fn.MultiFile.reEnableTimeout=window.setTimeout($.fn.MultiFile.reEnableEmpty,500);return $(o).each(function(){this.disabled=true}).addClass(klass);},reEnableEmpty:function(klass){klass=(typeof(klass)=='string'?klass:'')||'mfD';return $('input:file.'+klass).removeClass(klass).each(function(){this.disabled=false});},intercepted:{},intercept:function(methods,context,args){var method,value;args=args||[];if(args.constructor.toString().indexOf("Array")<0)args=[args];if(typeof(methods)=='function'){$.fn.MultiFile.disableEmpty();value=methods.apply(context||window,args);setTimeout(function(){$.fn.MultiFile.reEnableEmpty()},1000);return value;};if(methods.constructor.toString().indexOf("Array")<0)methods=[methods];for(var i=0;i<methods.length;i++){method=methods[i]+'';if(method)(function(method){$.fn.MultiFile.intercepted[method]=$.fn[method]||function(){};$.fn[method]=function(){$.fn.MultiFile.disableEmpty();value=$.fn.MultiFile.intercepted[method].apply(this,arguments);setTimeout(function(){$.fn.MultiFile.reEnableEmpty()},1000);return value;};})(method);};}});$.fn.MultiFile.options={accept:'',max:-1,maxfile:-1,maxsize:-1,namePattern:'$name',preview:false,previewCss:'max-height:100px; max-width:100px;',STRING:{remove:'x',denied:'You cannot select a $ext file.\nTry again...',file:'$file',selected:'File selected: $file',duplicate:'This file has already been selected:\n$file',toomuch:'The files selected exceed the maximum size permited ($size)',toomany:'Too many files selected (max: $max)',toobig:'$file is too big (max $size)'},autoIntercept:['submit','ajaxSubmit','ajaxForm','validate','valid'],error:function(s){if(typeof console!='undefined')console.log(s);alert(s);}};$.fn.reset=$.fn.reset||function(){return this.each(function(){try{this.reset();}catch(e){}});};$(function(){$("input[type=file].multi").MultiFile();});})(jQuery);